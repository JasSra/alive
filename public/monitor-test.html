<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor Test Page</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
        }
        .test-button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-family: monospace;
        }
        .test-button:hover {
            background: #0052a3;
        }
        .info {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
            border: 1px solid #333;
        }
    </style>
</head>
<body>
    <h1>🔍 Live Network Monitor Test Page</h1>
    
    <div class="info">
        <h3>Monitor Features Test</h3>
        <p>This page demonstrates the enhanced network monitor capabilities:</p>
        <ul>
            <li>✅ Network error logging with detailed metrics</li>
            <li>✅ Dynamic server URL configuration</li>
            <li>✅ Real-time connection status</li>
            <li>✅ Network activity history</li>
        </ul>
        
        <p><strong>Instructions:</strong></p>
        <ol>
            <li>Press <kbd>Ctrl+Shift+M</kbd> to show the monitor</li>
            <li>Click "Config" to access the configuration panel</li>
            <li>Try changing the server URL to test error handling</li>
            <li>Use the test buttons below to generate network activity</li>
        </ol>
    </div>

    <div class="info">
        <h3>Test Actions</h3>
        <button class="test-button" onclick="testSuccessRequest()">✅ Success Request</button>
        <button class="test-button" onclick="testErrorRequest()">❌ Error Request</button>
        <button class="test-button" onclick="testSlowRequest()">🐌 Slow Request</button>
        <button class="test-button" onclick="testBatchRequests()">📦 Batch Requests</button>
        <button class="test-button" onclick="changeServerUrl()">🔧 Test URL Change</button>
        <button class="test-button" onclick="showMonitorLogs()">📊 Show Monitor Logs</button>
    </div>

    <div class="info">
        <h3>Activity Log</h3>
        <div id="activity-log" class="log">Monitor will appear in top-right corner when loaded...\n</div>
    </div>

    <script src="http://localhost:3000/api/monitor.js"></script>
    <script>
        const log = document.getElementById('activity-log');
        
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            log.innerHTML += `[${timestamp}] ${message}\n`;
            log.scrollTop = log.scrollHeight;
        }

        async function testSuccessRequest() {
            addLog('🔄 Testing successful request...');
            try {
                const response = await fetch('/api/events/health');
                const data = await response.json();
                addLog(`✅ Success: ${response.status} - ${JSON.stringify(data)}`);
            } catch (error) {
                addLog(`❌ Error: ${error.message}`);
            }
        }

        async function testErrorRequest() {
            addLog('🔄 Testing error request...');
            try {
                const response = await fetch('/api/nonexistent-endpoint');
                addLog(`❌ Expected error: ${response.status} - ${response.statusText}`);
            } catch (error) {
                addLog(`❌ Network error: ${error.message}`);
            }
        }

        async function testSlowRequest() {
            addLog('🔄 Testing slow request (simulated delay)...');
            const start = Date.now();
            try {
                // Add delay parameter to simulate slow request
                const response = await fetch('/api/events/health?delay=2000');
                const duration = Date.now() - start;
                addLog(`🐌 Slow request completed in ${duration}ms`);
            } catch (error) {
                addLog(`❌ Slow request failed: ${error.message}`);
            }
        }

        async function testBatchRequests() {
            addLog('🔄 Testing batch requests...');
            const promises = [];
            for (let i = 0; i < 5; i++) {
                promises.push(fetch(`/api/events/health?batch=${i}`));
            }
            try {
                const responses = await Promise.all(promises);
                addLog(`📦 Batch completed: ${responses.length} requests`);
            } catch (error) {
                addLog(`❌ Batch failed: ${error.message}`);
            }
        }

        function changeServerUrl() {
            if (window.LiveMonitor) {
                addLog('🔧 Changing server URL to test error handling...');
                
                // First show current config
                const config = window.LiveMonitor.getConfig();
                addLog(`Current URL: ${config.serverUrl}`);
                
                // Change to invalid URL
                window.LiveMonitor.setServerUrl('http://invalid-server.com/api/events');
                addLog('Changed to invalid URL - monitor should show errors');
                
                // Restore after 10 seconds
                setTimeout(() => {
                    window.LiveMonitor.setServerUrl('http://localhost:3000/api/events');
                    addLog('✅ Restored original URL');
                }, 10000);
            } else {
                addLog('❌ Monitor not available');
            }
        }

        function showMonitorLogs() {
            if (window.LiveMonitor) {
                const logs = window.LiveMonitor.getNetworkLogs();
                addLog(`📊 Monitor has ${logs.success.length} success logs, ${logs.errors.length} error logs`);
                
                if (logs.errors.length > 0) {
                    addLog(`Last error: ${logs.errors[0].error || 'Unknown error'}`);
                }
                
                if (logs.success.length > 0) {
                    addLog(`Last success: ${logs.success[0].responseTimeMs}ms response time`);
                }
            } else {
                addLog('❌ Monitor not available');
            }
        }

        // Show monitor automatically after 2 seconds
        setTimeout(() => {
            if (window.LiveMonitor) {
                window.LiveMonitor.show();
                addLog('🚀 Monitor loaded and visible!');
                addLog('💡 Click "Config" button to see new features');
            }
        }, 2000);

        // Log monitor events
        window.addEventListener('load', () => {
            addLog('📄 Page loaded - monitor should start capturing events');
        });
    </script>
</body>
</html>
